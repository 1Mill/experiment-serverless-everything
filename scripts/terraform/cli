#!/usr/bin/env bash
set -e

function cli() {
	local path=$1
	local command=$2

	# * Load CLI environmental variables
	source $(dirname $BASH_SOURCE)/config

	# * Load .env from project root into the environment
	source $(dirname $BASH_SOURCE)/../../$ENV_FILENAME

	# * Load config variables into environment
	source $path/$CONFIG_FILENAME

	# * Computed values
	local dir=$PWD/$path
	local version=$TERRAFORM

	AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
	AWS_DEFAULT_REGION=$AWS_DEFAULT_REGION \
	AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
	COMMAND=$command \
	DIR=$dir \
	VERSION=$version \
	docker compose --file $(dirname $BASH_SOURCE)/docker-compose.yml up terraform
}

cli ${@:1} # * Pass through all arguments to function
