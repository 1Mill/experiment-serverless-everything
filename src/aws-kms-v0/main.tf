data "aws_iam_policy_document" "this" {
	version = "2012-10-17"

	statement {
		actions = ["kms:Decrypt"]
		effect = "Allow"
		resources = [resource.aws_kms_key.this.arn]
		sid = "DecryptSOPSFiles"
	}
}

resource "aws_kms_alias" "this" {
	name = "alias/experiment-serverless-everything"
	target_key_id = resource.aws_kms_key.this.key_id
}
resource "aws_kms_key" "this" {
	description = "Decrypt experiment-serverless-everything SOPS files generated by Terraform"
	enable_key_rotation = true
	is_enabled = true
}

output "policy" {
	description = "JSON formatted AWS Policy with decrypt permissions for this key"
	value = data.aws_iam_policy_document.this.json
}
